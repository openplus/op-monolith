!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.footnotes=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,o)=>{e.exports=o("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/engine.js":(e,t,o)=>{e.exports=o("dll-reference CKEditor5.dll")("./src/engine.js")},"ckeditor5/src/ui.js":(e,t,o)=>{e.exports=o("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/widget.js":(e,t,o)=>{e.exports=o("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";o.d(n,{default:()=>u});var e=o("ckeditor5/src/core.js"),t=o("ckeditor5/src/widget.js");class r extends e.Command{execute(e){const t=this.editor.plugins.get("footnotesEditing"),o=Object.entries(t.attrs).reduce(((e,[t,o])=>(e[o]=t,e)),{}),n=Object.keys(e).reduce(((t,n)=>(o[n]&&(void 0!==e[n].value?t[o[n]]=e[n].value:t[o[n]]=e[n]),t)),{});this.editor.model.change((e=>{this.editor.model.insertContent(function(e,t){return e.createElement("footnotes",t)}(e,n))}))}refresh(){const{model:e}=this.editor,{selection:t}=e.document,o=e.schema.findAllowedParent(t.getFirstPosition(),"footnotes");this.isEnabled=null!==o}}function s(e){e.querySelectorAll('.sdfootnote, [ id*="ftn"] > p').forEach((t=>{let o;t.childNodes.forEach((e=>{e.nodeType===Node.TEXT_NODE&&(o=e.textContent.trim())}));const n=t.querySelector('.sdfootnotesym, [ href*="_ftnref"]');if(n){let t=n.getAttribute("href").replace(/anc|ref|_/g,"");t="#"+t.split("#").pop();const r=e.querySelector(`.sdfootnoteanc[href*="${t}sym"], [href*="_ftn"]`),s=e.querySelector(`div${t}`),i="";if(r){if(void 0===o&&s.querySelector(".MsoFootnoteReference")){const e=s.querySelector(".MsoFootnoteReference").parentNode;e.parentNode.removeChild(e),o=s.querySelector(".MsoFootnoteText").innerHTML}const e=function(e,t){const o=document.createElement("footnotes");return o.setAttribute("data-value",e),o.setAttribute("data-text",t),o.innerHTML="&nbsp;",o}(i,o);r.parentNode.replaceChild(e,r),s.parentNode.removeChild(s)}}}));return e.querySelectorAll("footnotes").forEach((e=>{e.setAttribute("data-value","")})),e}class i extends e.Plugin{static get requires(){return[t.Widget]}static get pluginName(){return"footnotesEditing"}init(){this.attrs={footnotesText:"data-text",footnotesValue:"data-value"};const e=this.editor.config.get("footnotes");if(!e)return;const{previewURL:t,themeError:o}=e;this.previewUrl=t,this.themeError=o||`\n        <p>${Drupal.t("An error occurred while trying to preview the embedded content. Please save your work and reload this page.")}<p>\n        `,this._defineSchema(),this._defineConverters(),this.editor.commands.add("footnotes",new r(this.editor)),this.editor.plugins.get("ClipboardPipeline").on("inputTransformation",((e,t)=>{const o=t.content,n=s(this.editor.editing.view.domConverter.viewToDom(o)),r=this.editor.editing.view.domConverter.domToView(n);t.content=r}),{priority:"highest"})}async _fetchPreview(e){const t={text:e.getAttribute("footnotesText"),value:e.getAttribute("footnotesValue")},o=await fetch(`${this.previewUrl}?${new URLSearchParams(t)}`);return o.ok?o.text():this.themeError}_defineSchema(){const{schema:e}=this.editor.model;e.register("footnotes",{allowWhere:"$inlineObject",blockObject:!1,isObject:!0,isContent:!0,isBlock:!1,isInline:!0,inlineObject:!0,allowAttributes:Object.keys(this.attrs)}),this.editor.editing.view.domConverter.blockElements.push("footnotes")}_defineConverters(){const{conversion:e}=this.editor;e.for("upcast").elementToElement({view:{name:"footnotes"},model:"footnotes"}),e.for("dataDowncast").elementToElement({model:"footnotes",view:{name:"footnotes"}}),e.for("editingDowncast").elementToElement({model:"footnotes",view:(e,{writer:o})=>{const n=o.createContainerElement("span");return(0,t.toWidget)(n,o,{label:Drupal.t("Footnotes")})}}).add((e=>(e.on("attribute:footnotesValue:footnotes",((e,t,o)=>{const n=o.writer,r=t.item,s=o.mapper.toViewElement(t.item),i=n.createRawElement("span",{"data-footnotes-preview":"loading",class:"footnotes-preview"});n.insert(n.createPositionAt(s,0),i),this._fetchPreview(r).then((e=>{i&&this.editor.editing.view.change((t=>{const o=t.createRawElement("span",{class:"footnotes-preview","data-footnotes-preview":"ready"},(t=>{t.innerHTML=e}));t.insert(t.createPositionBefore(i),o),t.remove(i)}))}))})),e))),Object.keys(this.attrs).forEach((t=>{const o={model:{key:t,name:"footnotes"},view:{name:"footnotes",key:this.attrs[t]}};e.for("dataDowncast").attributeToAttribute(o),e.for("upcast").attributeToAttribute(o)}))}}var a=o("ckeditor5/src/ui.js"),c=o("ckeditor5/src/engine.js");class d extends c.DomEventObserver{constructor(e){super(e),this.domEventType="dblclick"}onDomEvent(e){this.fire(e.type,e)}}class l extends e.Plugin{init(){const{editor:e}=this,t=this.editor.config.get("footnotes");if(!t)return;const{dialogURL:o,openDialog:n,dialogSettings:r={}}=t;if(!o||"function"!=typeof n)return;e.ui.componentFactory.add("footnotes",(t=>{const s=e.commands.get("footnotes"),i=new a.ButtonView(t);return i.set({label:Drupal.t("Footnotes"),icon:'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="16.000000pt" height="16.000000pt" viewBox="0 0 16.000000 16.000000"\n preserveAspectRatio="xMidYMid meet">\n\n<g transform="translate(0.000000,16.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M115 115 c0 -14 5 -25 11 -25 7 0 9 10 6 25 -2 14 -7 25 -11 25 -3 0\n-6 -11 -6 -25z"/>\n<path d="M35 110 c-4 -6 5 -10 19 -10 14 0 26 -4 26 -10 0 -5 -8 -10 -19 -10\n-24 0 -45 -25 -38 -45 4 -9 19 -14 42 -13 33 1 35 3 35 38 0 20 -5 41 -12 48\n-15 15 -45 16 -53 2z m45 -60 c0 -5 -9 -10 -20 -10 -11 0 -20 5 -20 10 0 6 9\n10 20 10 11 0 20 -4 20 -10z"/>\n</g>\n</svg>\n',tooltip:!0}),i.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(i,"execute",(()=>{const t=e.model.document.selection.getSelectedElement(),s=new URL(o,document.baseURI);t&&void 0!==t.name&&"footnotes"===t.name&&(s.searchParams.append("text",t.getAttribute("footnotesText")),s.searchParams.append("value",t.getAttribute("footnotesValue"))),n(s.toString(),(({attributes:t})=>{e.execute("footnotes",t)}),r)})),i}));const{view:s}=e.editing,i=s.document;s.addObserver(d),e.listenTo(i,"dblclick",((t,s)=>{const i=e.editing.mapper.toModelElement(s.target.parent);if(i&&void 0!==i.name&&"footnotes"===i.name){const t={text:i.getAttribute("footnotesText"),value:i.getAttribute("footnotesValue")};n(`${o}?${new URLSearchParams(t)}`,(({attributes:t})=>{e.execute("footnotes",t)}),r)}}))}}class f extends e.Plugin{static get requires(){return[i,l]}static get pluginName(){return"footnotes"}}const u={Footnotes:f}})(),n=n.default})()));