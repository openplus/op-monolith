!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.abbreviation=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{"use strict";i.d(s,{default:()=>v});var e=i("ckeditor5/src/core.js");function t(e,t,i,s){return s.createRange(o(e,t,i,!0,s),o(e,t,i,!1,s))}function o(e,t,i,s,o){let r=e.textNode||(s?e.nodeBefore:e.nodeAfter),n=null;for(;r&&r.getAttribute(t)==i;)n=r,r=s?r.previousSibling:r.nextSibling;return n?o.createPositionAt(n,s?"before":"after"):e}function r(e){return Array.from(e.getItems()).reduce(((e,t)=>t.is("text")||t.is("textProxy")?e+t.data:e),"")}var n=i("ckeditor5/src/utils.js");class a extends e.Command{refresh(){const e=this.editor.model,i=e.document.selection,s=i.getFirstRange();if(s.isCollapsed)if(i.hasAttribute("abbreviation")){const s=i.getAttribute("abbreviation"),o=t(i.getFirstPosition(),"abbreviation",s,e);this.value={abbr:r(o),title:s,range:o}}else this.value=null;else if(i.hasAttribute("abbreviation")){const o=i.getAttribute("abbreviation");t(i.getFirstPosition(),"abbreviation",o,e).containsRange(s,!0)?this.value={abbr:r(s),title:o,range:s}:this.value=null}else this.value=null;this.isEnabled=e.schema.checkAttributeInSelection(i,"abbreviation")}execute({abbr:e,title:t}){const i=this.editor.model,s=i.document.selection;i.change((o=>{if(s.isCollapsed){if(this.value){const{end:s}=i.insertContent(o.createText(e,{abbreviation:t}),this.value.range);o.setSelection(s)}else if(""!==e){const r=s.getFirstPosition(),a=(0,n.toMap)(s.getAttributes());a.set("abbreviation",t);const{end:l}=i.insertContent(o.createText(e,a),r);o.setSelection(l)}o.removeSelectionAttribute("abbreviation")}else{const e=i.schema.getValidRanges(s.getRanges(),"abbreviation");for(const i of e)o.setAttribute("abbreviation",t,i)}}))}}class l extends a{refresh(){super.refresh(),this.isEnabled=!!this.value}execute(){const e=this.editor.model,i=e.document.selection;e.change((s=>{if(i.isCollapsed&&i.hasAttribute("abbreviation")){const o=t(i.getFirstPosition(),"abbreviation",i.getAttribute("abbreviation"),e);s.removeAttribute("abbreviation",o)}else{const t=e.schema.getValidRanges(i.getRanges(),"abbreviation");for(const e of t)s.removeAttribute("abbreviation",e)}}))}}class c extends e.Plugin{init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("addAbbreviation",new a(this.editor)),this.editor.commands.add("removeAbbreviation",new l(this.editor))}_defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:["abbreviation"]})}_defineConverters(){const e=this.editor.conversion;e.for("downcast").attributeToElement({model:"abbreviation",view:(e,t)=>{const{writer:i}=t;let s=e?{title:e}:null;return i.createAttributeElement("abbr",s)}}),e.for("upcast").elementToAttribute({view:{name:"abbr",attributes:["title"]},model:{key:"abbreviation",value:e=>e.getAttribute("title")}})}}var u=i("ckeditor5/src/ui.js");class d extends u.View{constructor(t){super(t),this.focusTracker=new n.FocusTracker,this.keystrokes=new n.KeystrokeHandler,this.abbrInputView=this._createInput(Drupal.t("Add abbreviation")),this.titleInputView=this._createInput(Drupal.t("Add title")),this.saveButtonView=this._createButton(Drupal.t("Save"),e.icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(Drupal.t("Cancel"),e.icons.cancel,"ck-button-cancel"),this.cancelButtonView.delegate("execute").to(this,"cancel"),this.removeButtonView=this._createButton("Remove",e.icons.eraser,"ck-button-remove"),this.removeButtonView.delegate("execute").to(this,"remove"),this.childViews=this.createCollection([this.abbrInputView,this.titleInputView,this.saveButtonView,this.cancelButtonView,this.removeButtonView]),this._focusCycler=new u.FocusCycler({focusables:this.childViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-abbr-form"],tabindex:"-1"},children:this.childViews})}render(){super.render(),(0,u.submitHandler)({view:this}),this.childViews._items.forEach((e=>{this.focusTracker.add(e.element)})),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.abbrInputView.isEnabled?this.abbrInputView.focus():this.titleInputView.focus()}_createInput(e){const t=new u.LabeledFieldView(this.locale,u.createLabeledInputText);return t.label=e,t}_createButton(e,t,i){const s=new u.ButtonView;return s.set({label:e,icon:t,tooltip:!0,class:i}),s}}class b extends e.Plugin{static get requires(){return[u.ContextualBalloon]}init(){const e=this.editor;this._balloon=this.editor.plugins.get(u.ContextualBalloon),this.formView=this._createFormView();const t=e.commands.get("addAbbreviation");e.ui.componentFactory.add("abbreviation",(e=>{const i=new u.ButtonView(e);return i.set({label:Drupal.t("Abbreviation"),tooltip:!0,icon:'<?xml version="1.0" ?><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M 6.66667,4.7619 H 4 c -1.33333,0 -1.33333,1.9047714 -1.33333,1.9047714 H 8 C 8,6.6666714 8,4.7619 6.66667,4.7619 Z m 0,3.8095286 H 4 c -1.33333,0 -1.33333,1.9047574 -1.33333,1.9047574 H 8 c 0,0 0,-1.9047574 -1.33333,-1.9047574 z m 0,3.8095284 H 4 c -1.33333,0 -1.33333,1.904757 -1.33333,1.904757 H 8 c 0,0 0,-1.904757 -1.33333,-1.904757 z M 16,4.7619 H 13.33333 C 12,4.7619 12,6.6666714 12,6.6666714 h 5.33333 c 0,0 0,-1.9047714 -1.33333,-1.9047714 z m 0,3.8095286 H 13.33333 C 12,8.5714286 12,10.476186 12,10.476186 h 5.33333 c 0,0 0,-1.9047574 -1.33333,-1.9047574 z m 0,3.8095284 H 13.33333 C 12,12.380957 12,14.285714 12,14.285714 h 5.33333 c 0,0 0,-1.904757 -1.33333,-1.904757 z M 12.66667,0 C 11.33333,0 10,1.9047571 10,1.9047571 10,1.9047571 8.66667,0 7.33333,0 4,0 0,1.9047571 0,1.9047571 V 20 l 9.33333,-0.952386 c 0,0 -0.0267,0.952386 0.65365,0.952386 0.67969,0 0.67969,-0.952386 0.67969,-0.952386 L 20,20 V 1.9047571 C 20,1.9047571 16,0 12.66667,0 Z M 9.33333,18.095243 c 0,0 0.0215,-1.904772 -1.33333,-1.904772 -4.02148,0 -6.66667,1.904772 -6.66667,1.904772 V 2.8571429 c 0,0 2.66667,-0.9523858 5.33334,-0.9523858 1.33333,0 2.66666,1.9047715 2.66666,1.9047715 z m 9.33334,-0.952386 c 0,0 -2.02084,-0.952386 -6.66667,-0.952386 -1.29167,0 -1.33333,1.904772 -1.33333,1.904772 V 3.8095286 c 0,0 1.33333,-1.9047715 2.66666,-1.9047715 2.66667,0 5.33334,1.9047715 5.33334,1.9047715 z"/></svg>\n'}),this.listenTo(i,"execute",(()=>{this._showUI()})),i.bind("isOn","isEnabled").to(t,"value","isEnabled"),i}))}_createFormView(){const e=this.editor,t=new d(e.locale);return this.listenTo(t,"submit",(()=>{const i={abbr:t.abbrInputView.fieldView.element.value,title:t.titleInputView.fieldView.element.value};e.execute("addAbbreviation",i),this._hideUI()})),this.listenTo(t,"remove",(()=>{e.execute("removeAbbreviation"),this._hideUI()})),this.listenTo(t,"cancel",(()=>{this._hideUI()})),(0,u.clickOutsideHandler)({emitter:t,activator:()=>this._balloon.visibleView===t,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),t}_showUI(){const e=this.editor.model.document.selection,t=this.editor.commands.get("addAbbreviation").value;if(this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.removeButtonView.isEnabled=!!t,this.formView.abbrInputView.isEnabled=e.getFirstRange().isCollapsed,t)this.formView.abbrInputView.fieldView.value=t.abbr,this.formView.titleInputView.fieldView.value=t.title;else{const t=r(e.getFirstRange());this.formView.abbrInputView.fieldView.value=t,this.formView.titleInputView.fieldView.value=""}this.formView.focus()}_hideUI(){this.formView.abbrInputView.fieldView.value="",this.formView.titleInputView.fieldView.value="",this.formView.element.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;let i=null;return i=()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange()),{target:i}}}class h extends e.Plugin{static get requires(){return[c,b]}}const v={Abbreviation:h}})(),s=s.default})()));